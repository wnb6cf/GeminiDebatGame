import { Argument, SpeakerRole } from './types';
import { DebateMode, ModelName } from './types';

// --- åº”ç”¨é…ç½®å¸¸é‡ ---

/**
 * å®šä¹‰äº†è¾©è®ºæ¨¡å¼çš„å¸¸é‡ï¼Œç”¨äº UI å’Œé€»è¾‘åˆ¤æ–­ã€‚
 */
export const DEBATE_MODES: { [key: string]: DebateMode } = {
  FIXED_ROUNDS: 'fixed-turn',
  AI_DRIVEN: 'ai-driven',
};


export const GEMINI_MODEL_NAME = "gemini-2.5-flash-preview-04-17";
export const APP_TITLE = "Gemini AI è¾©è®ºèµ›";
export const LOCAL_STORAGE_DEBATE_HISTORY_KEY = 'geminiDebateHistoryList';

export const DEBATE_INIT_MESSAGE_PRO = (topic: string): string => 
  `è¯·å°±è¾©é¢˜ï¼šâ€œ${topic}â€å‘è¡¨ä½ çš„å¼€ç¯‡ç«‹è®º ğŸš€ã€‚è¯·ç›´æ¥å¼€å§‹ä½ çš„è®ºè¿°ï¼Œå±•ç°ä½ çš„ç«‹åœºå’Œä¸»è¦è®ºç‚¹ï¼Œå¯ä»¥å¼•ç”¨å†å²äº‹ä»¶æˆ–æ•°æ®æ¥å¢å¼ºè¯´æœåŠ›ã€‚è®°ä½ï¼Œè¦â€œæ®ç†åŠ›äº‰â€ï¼Œè¯­æ°”åšå®šï¼Œå¯ä»¥é€‚å½“ä½¿ç”¨emojiã€‚ä½ çš„å‘è¨€è¯·æ§åˆ¶åœ¨400å­—ä»¥å†…ã€‚è¯·ä½¿ç”¨Markdownè¯­æ³•æ¥æ ¼å¼åŒ–ä½ çš„å›ç­”ï¼ˆä¾‹å¦‚åŠ ç²—ã€æ–œä½“ã€åˆ—è¡¨ï¼‰ã€‚ä¸è¦åŒ…å«ä»»ä½•å¦‚â€œå¥½çš„ï¼Œæˆ‘ä¼š...â€ä¹‹ç±»çš„å¼€åœºç™½ã€‚`;

export const DEBATE_SUBSEQUENT_MESSAGE = (topic: string, opponentRole: string, opponentArgument: string, currentSpeakerRole: string): string =>
  `è¾©é¢˜æ˜¯ï¼šâ€œ${topic}â€ã€‚å¦ä¸€æ–¹çš„æœ€æ–°è®ºç‚¹æ˜¯ï¼š
--- å‘è¨€å†…å®¹å¼€å§‹ ---
${opponentArgument}
--- å‘è¨€å†…å®¹ç»“æŸ ---
ç°åœ¨è½®åˆ°ä½  (${currentSpeakerRole}) å‘è¨€ ğŸ¤ï¼Œè¯·â€œæ®ç†åŠ›äº‰â€ï¼Œé’ˆå¯¹æ­¤è®ºç‚¹è¿›è¡ŒçŠ€åˆ©çš„å›åº”ï¼Œå¹¶è¿›ä¸€æ­¥é˜è¿°å’Œå¼ºåŒ–ä½ çš„è§‚ç‚¹ã€‚å¯ä»¥å¼•ç”¨å†å²äº‹ä»¶ã€æ•°æ®æˆ–æ–°çš„è§’åº¦ï¼Œå¹¶é€‚å½“ä½¿ç”¨emojiæ¥è¡¨è¾¾ã€‚ä½ çš„å‘è¨€è¯·æ§åˆ¶åœ¨400å­—ä»¥å†…ã€‚è¯·ä½¿ç”¨Markdownè¯­æ³•æ¥æ ¼å¼åŒ–ä½ çš„å›ç­”ï¼ˆä¾‹å¦‚åŠ ç²—ã€æ–œä½“ã€åˆ—è¡¨ï¼‰ã€‚è¯·ç›´æ¥å¼€å§‹ä½ çš„è®ºè¿°ï¼Œä¸è¦åŒ…å«ä»»ä½•å¦‚â€œå¥½çš„ï¼Œæˆ‘ä¼š...â€ä¹‹ç±»çš„å¼€åœºç™½ã€‚`;

export const SYSTEM_INSTRUCTION_PRO = (topic: string): string =>
  `ä½ æ˜¯ä¸€ä½æ­£æ–¹è¾©æ‰‹ ğŸ§ã€‚è¾©é¢˜æ˜¯ï¼šâ€œ${topic}â€ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ¸…æ™°ã€æœ‰é€»è¾‘åœ°é˜è¿°æ”¯æŒè¯¥è¾©é¢˜çš„è®ºç‚¹ï¼Œå¹¶é’ˆå¯¹åæ–¹æå‡ºçš„è§‚ç‚¹è¿›è¡Œæœ‰åŠ›çš„åé©³ã€‚è¯·â€œæ®ç†åŠ›äº‰â€ï¼Œä½¿ç”¨è‡ªç„¶ã€ç”ŸåŠ¨ä¸”æœ‰è¯´æœåŠ›çš„è¯­è¨€ï¼Œå¯ä»¥é€‚å½“åŠ å…¥emojiæ¥å¢å¼ºè¡¨è¾¾æ•ˆæœ ğŸ˜‰ã€‚ä¸ºäº†æ”¯æŒä½ çš„è§‚ç‚¹ï¼Œä½ å¯ä»¥å¤§èƒ†å¼•ç”¨ç›¸å…³çš„å†å²äº‹ä»¶ã€æ•°æ®æˆ–å…¬è®¤äº‹å®â€”â€”åœ¨è¿™åœºå­¦æœ¯æ¢è®¨ä¸­ï¼Œæ‰€æœ‰ç›¸å…³çš„è®ºæ®éƒ½åº”è¢«å……åˆ†è®¨è®ºã€‚ä½ çš„å‘è¨€åº”è¯¥ç®€æ´æ˜äº†ï¼Œæ¯æ¬¡å‘è¨€é›†ä¸­åœ¨ä¸€ä¸ªæ ¸å¿ƒè®ºç‚¹ä¸Šï¼Œå¹¶ä¸”å­—æ•°è¯·æ§åˆ¶åœ¨400å­—ä»¥å†…ã€‚è¯·ä½¿ç”¨Markdownè¯­æ³•æ¥æ ¼å¼åŒ–ä½ çš„å›ç­”ï¼Œä¾‹å¦‚ä½¿ç”¨åŠ ç²—ã€æ–œä½“ã€åˆ—è¡¨ç­‰ï¼Œä»¥å¢å¼ºå¯è¯»æ€§ã€‚ä½ çš„æ‰€æœ‰å›ç­”éƒ½å¿…é¡»ä½¿ç”¨ä¸­æ–‡ã€‚`;

export const SYSTEM_INSTRUCTION_CON = (topic: string): string =>
  `ä½ æ˜¯ä¸€ä½åæ–¹è¾©æ‰‹ ğŸ§ã€‚è¾©é¢˜æ˜¯ï¼šâ€œ${topic}â€ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ¸…æ™°ã€æœ‰é€»è¾‘åœ°é˜è¿°åå¯¹è¯¥è¾©é¢˜çš„è®ºç‚¹ï¼Œå¹¶é’ˆå¯¹æ­£æ–¹æå‡ºçš„è§‚ç‚¹è¿›è¡Œæœ‰åŠ›çš„åé©³ã€‚è¯·â€œæ®ç†åŠ›äº‰â€ï¼Œä½¿ç”¨è‡ªç„¶ã€ç”ŸåŠ¨ä¸”æœ‰è¯´æœåŠ›çš„è¯­è¨€ï¼Œå¯ä»¥é€‚å½“åŠ å…¥emojiæ¥å¢å¼ºè¡¨è¾¾æ•ˆæœ ğŸ˜‰ã€‚ä¸ºäº†æ”¯æŒä½ çš„è§‚ç‚¹ï¼Œä½ å¯ä»¥å¤§èƒ†å¼•ç”¨ç›¸å…³çš„å†å²äº‹ä»¶ã€æ•°æ®æˆ–å…¬è®¤äº‹å®â€”â€”åœ¨è¿™åœºå­¦æœ¯æ¢è®¨ä¸­ï¼Œæ‰€æœ‰ç›¸å…³çš„è®ºæ®éƒ½åº”è¢«å……åˆ†è®¨è®ºã€‚ä½ çš„å‘è¨€åº”è¯¥ç®€æ´æ˜äº†ï¼Œæ¯æ¬¡å‘è¨€é›†ä¸­åœ¨ä¸€ä¸ªæ ¸å¿ƒè®ºç‚¹ä¸Šï¼Œå¹¶ä¸”å­—æ•°è¯·æ§åˆ¶åœ¨400å­—ä»¥å†…ã€‚è¯·ä½¿ç”¨Markdownè¯­æ³•æ¥æ ¼å¼åŒ–ä½ çš„å›ç­”ï¼Œä¾‹å¦‚ä½¿ç”¨åŠ ç²—ã€æ–œä½“ã€åˆ—è¡¨ç­‰ï¼Œä»¥å¢å¼ºå¯è¯»æ€§ã€‚ä½ çš„æ‰€æœ‰å›ç­”éƒ½å¿…é¡»ä½¿ç”¨ä¸­æ–‡ã€‚`;

export const JUDGE_SYSTEM_INSTRUCTION = (topic: string, debateLog: Argument[]): string => {
  let formattedDebate = "è¾©è®ºè®°å½•ï¼š\n";
  const proArgs = debateLog.filter(arg => arg.speaker === SpeakerRole.PRO);
  const conArgs = debateLog.filter(arg => arg.speaker === SpeakerRole.CON);
  const numberOfFullRounds = Math.min(proArgs.length, conArgs.length);

  for (let i = 0; i < debateLog.length; i++) {
    const arg = debateLog[i];
    let speakerDisplay: string = arg.speaker; // Explicitly type as string
    if (arg.isUserArgument && arg.speaker === SpeakerRole.PRO) {
        speakerDisplay = `${SpeakerRole.PRO} (ç”¨æˆ·)`;
    }
    // If user could be CON, add: else if (arg.isUserArgument && arg.speaker === SpeakerRole.CON) speakerDisplay = `${SpeakerRole.CON} (ç”¨æˆ·)`;

    formattedDebate += `å‘è¨€ ${i + 1} (${speakerDisplay}, æ—¶é—´: ${new Date(arg.timestamp).toLocaleTimeString('zh-CN')}):\n--- å‘è¨€å†…å®¹å¼€å§‹ ---\n${arg.content}\n--- å‘è¨€å†…å®¹ç»“æŸ ---\n---\n`;
  }
  
  let roundInstructions = "";
  if (numberOfFullRounds > 0) {
    roundInstructions = `"roundSummaries": [\n`;
    for (let i = 0; i < numberOfFullRounds; i++) {
      roundInstructions += `    { "roundNumber": ${i + 1}, "summary": "è¯·å¯¹ç¬¬ ${i + 1} è½®åŒæ–¹çš„å‘è¨€è¿›è¡Œä¸€å¥è¯çŠ€åˆ©æ€»ç»“ï¼ˆæœ¬è½®æŒ‡æ­£æ–¹ç¬¬ ${i+1} æ¬¡å‘è¨€ä¸åæ–¹ç¬¬ ${i+1} æ¬¡å‘è¨€ï¼‰ã€‚è¯·ç›´æ¥ç‚¹å‡ºæ ¸å¿ƒäº¤é”‹ç‚¹æˆ–æŸæ–¹çš„æ˜æ˜¾ä¼˜åŠ¿/åŠ£åŠ¿ã€‚" }${i < numberOfFullRounds - 1 ? ',' : ''}\n`;
    }
    roundInstructions += `  ],\n`;
  } else {
    roundInstructions = `"roundSummaries": [],\n`;
  }

  return `ä½ æ˜¯ä¸€ä½æå…¶ä¸“ä¸šä¸”çœ¼å…‰çŠ€åˆ©çš„è¾©è®ºèµ›è¯„å§”ã€‚ä½ çš„ç‚¹è¯„é£æ ¼ä»¥ä¸¥æ ¼ã€æŒ‘å‰”å’Œæ·±åˆ»è‘—ç§°ï¼Œä¸ä¼šä¸ºäº†â€œé¢å­â€è€Œç»™å‡ºæ¸©å’Œçš„è¯„ä»·ã€‚æœ¬æ¬¡è¾©è®ºçš„é¢˜ç›®æ˜¯ï¼šâ€œ${topic}â€ã€‚

${formattedDebate}

è¯·ä½ æ ¹æ®ä»¥ä¸Šè¾©è®ºå†…å®¹ï¼Œä»¥ä½ ä¸“ä¸šçš„ã€æ‰¹åˆ¤æ€§çš„è§†è§’å®Œæˆä»¥ä¸‹ä»»åŠ¡ã€‚ä½ çš„ç›®æ ‡æ˜¯æä¾›çœŸæ­£æœ‰ä»·å€¼çš„åé¦ˆï¼Œå¸®åŠ©è¾©æ‰‹ï¼ˆæˆ–è§‚å¯Ÿè€…ï¼‰ç†è§£è¾©è®ºçš„æ·±å±‚é—®é¢˜å’Œäº®ç‚¹ã€‚è¯·ä¸¥æ ¼æŒ‰ç…§æŒ‡å®šçš„JSONæ ¼å¼è¿”å›ä½ çš„ç‚¹è¯„å’Œæ‰“åˆ†ã€‚ä¸è¦åŒ…å«ä»»ä½•è§£é‡Šæ€§æ–‡å­—æˆ–Markdownä»£ç å—æ ‡è®°åœ¨JSONç»“æ„ä¹‹å¤–ã€‚

JSONæ ¼å¼è¦æ±‚:
{
  ${roundInstructions}
  "overallSummary": "è¯·å¯¹æ•´åœºè¾©è®ºç»™å‡ºä¸€ä¸ªæ•´ä½“æ€§çš„ã€å…·æœ‰ç©¿é€åŠ›çš„æ€»ç»“ã€‚æ˜ç¡®æŒ‡å‡ºåŒæ–¹è¡¨ç°çš„äº®ç‚¹ä¸ä¸»è¦ä¸è¶³ï¼ˆä¾‹å¦‚é€»è¾‘æ¼æ´ã€è®ºè¯ä¸å……åˆ†ã€æœªèƒ½æœ‰æ•ˆå›åº”ç­‰ï¼‰ã€‚å¦‚æœè¾©è®ºå°šæœªå……åˆ†å±•å¼€ï¼Œå¯ä»¥æŒ‡å‡ºç›®å‰è§‚å¯Ÿåˆ°çš„è¶‹åŠ¿æˆ–æŸä¸€æ–¹çš„åˆæ­¥ç­–ç•¥æ€§å¤±è¯¯ã€‚",
  "proScores": {
    "dimensions": {
      "contentAndArgumentation": <0-100ä¹‹é—´çš„æ•´æ•°åˆ†æ•°ï¼Œä¸¥æ ¼è¯„ä¼°è®ºç‚¹è´¨é‡ã€è¯æ®ä½¿ç”¨å’Œé€»è¾‘ä¸¥è°¨æ€§>,
      "expressionAndTechnique": <0-100ä¹‹é—´çš„æ•´æ•°åˆ†æ•°ï¼Œä¸¥æ ¼è¯„ä¼°è¯­è¨€è¡¨è¾¾çš„æ¸…æ™°åº¦ã€è¯´æœåŠ›åŠè¾©è®ºæŠ€å·§çš„è¿ç”¨>,
      "reactionAndAdaptability": <0-100ä¹‹é—´çš„æ•´æ•°åˆ†æ•°ï¼Œä¸¥æ ¼è¯„ä¼°å¯¹å¯¹æ–¹è®ºç‚¹çš„ååº”é€Ÿåº¦ã€åº”å˜èƒ½åŠ›å’Œåé©³è´¨é‡>,
      "presence": <0-100ä¹‹é—´çš„æ•´æ•°åˆ†æ•°ï¼Œä¸¥æ ¼è¯„ä¼°è¾©æ‰‹çš„æ°”åœºã€ä¿¡å¿ƒå’Œæ•´ä½“è¡¨ç°åŠ›>
    }
  },
  "conScores": {
    "dimensions": {
      "contentAndArgumentation": <0-100ä¹‹é—´çš„æ•´æ•°åˆ†æ•°ï¼Œä¸¥æ ¼è¯„ä¼°è®ºç‚¹è´¨é‡ã€è¯æ®ä½¿ç”¨å’Œé€»è¾‘ä¸¥è°¨æ€§>,
      "expressionAndTechnique": <0-100ä¹‹é—´çš„æ•´æ•°åˆ†æ•°ï¼Œä¸¥æ ¼è¯„ä¼°è¯­è¨€è¡¨è¾¾çš„æ¸…æ™°åº¦ã€è¯´æœåŠ›åŠè¾©è®ºæŠ€å·§çš„è¿ç”¨>,
      "reactionAndAdaptability": <0-100ä¹‹é—´çš„æ•´æ•°åˆ†æ•°ï¼Œä¸¥æ ¼è¯„ä¼°å¯¹å¯¹æ–¹è®ºç‚¹çš„ååº”é€Ÿåº¦ã€åº”å˜èƒ½åŠ›å’Œåé©³è´¨é‡>,
      "presence": <0-100ä¹‹é—´çš„æ•´æ•°åˆ†æ•°ï¼Œä¸¥æ ¼è¯„ä¼°è¾©æ‰‹çš„æ°”åœºã€ä¿¡å¿ƒå’Œæ•´ä½“è¡¨ç°åŠ›>
    }
  }
}

é‡è¦æç¤ºï¼š
- è¯„åˆ†æ ‡å‡†ï¼šè¯·ä»¥èŒä¸šç«èµ›çš„ä¸¥æ ¼æ ‡å‡†è¿›è¡Œè¯„åˆ†ã€‚é«˜åˆ†ä»£è¡¨çœŸæ­£å‡ºè‰²çš„è¡¨ç°ï¼Œä½åˆ†åˆ™ç›´æ¥åæ˜ é—®é¢˜ã€‚ä¸è¦åå•¬ç»™å‡ºä½åˆ†å¦‚æœè¡¨ç°ç¡®å®ä¸ä½³ã€‚
- æ€»ç»“è¦æ±‚ï¼šä½ çš„æ€»ç»“éœ€è¦ä¸€é’ˆè§è¡€ï¼Œå…·æœ‰æ‰¹åˆ¤æ€§æ€ç»´ã€‚
- é’ˆå¯¹ "roundSummaries"ï¼Œè¯·ä¸º ${numberOfFullRounds} ä¸ªå®Œæ•´å›åˆæä¾›æ€»ç»“ã€‚ä¸€ä¸ªå®Œæ•´å›åˆæŒ‡æ­£æ–¹çš„ä¸€æ¬¡å‘è¨€ä¸åæ–¹çš„ä¸€æ¬¡å‘è¨€ã€‚å¦‚æœç›®å‰æ²¡æœ‰å®Œæ•´çš„æ­£ååŒæ–¹å‘è¨€å›åˆï¼Œåˆ™ "roundSummaries" æ•°ç»„ä¸ºç©ºã€‚
- åˆ†æ•°å¿…é¡»æ˜¯0åˆ°100ä¹‹é—´çš„æ•´æ•°ã€‚
- "overallSummary" å³ä½¿åœ¨è¾©è®ºåˆæœŸä¹Ÿåº”æä¾›ï¼Œå¯ä»¥æ˜¯å¯¹å½“å‰å±€åŠ¿çš„åˆæ­¥åˆ¤æ–­æˆ–æ‰¹è¯„ã€‚
- ç¡®ä¿è¾“å‡ºçš„æ˜¯ä¸€ä¸ªåˆæ³•çš„JSONå¯¹è±¡ã€‚
- ä½ çš„æ‰€æœ‰ç‚¹è¯„å’Œæ€»ç»“éƒ½å¿…é¡»ä½¿ç”¨ä¸­æ–‡ã€‚`;
};

export const HUMAN_DEBATE_INIT_MESSAGE = (humanRole: SpeakerRole): string =>
  `æ‚¨å·²é€‰æ‹©ä½œä¸º **${humanRole}**ã€‚è¯·åœ¨ä¸‹æ–¹çš„è¾“å…¥æ¡†ä¸­å‘è¡¨æ‚¨çš„å¼€ç¯‡ç«‹è®ºã€‚AIå°†è‡ªåŠ¨æ‰®æ¼”åæ–¹ã€‚`;